<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Jste Manager</title>
    <link rel="shortcut icon" href="./res/img/logo.png" type="image/x-icon">
    <script src="./res/JS/please-wait.min.js"></script>
    <link rel="stylesheet" href="./res/CSS/please-wait.css">
    <link rel="stylesheet" href="./res/CSS/spinkit.css">
    <link rel="stylesheet" href="./res/CSS/Google Material Icons.css">
    <script src="./res/JS/jquery-3.2.1.min.js"></script>
    <link rel="stylesheet" href="./res/CSS/material.min.css">
    <script src="./res/JS/material.min.js"></script>
    <script src="./res/JS/utils.js"></script>
    <script>
        window.onload = function () {
            document.loading_screen = pleaseWait({
                logo: './res/img/logo.png',
                backgroundColor: '#f46d3b',
                loadingHtml: '<div class="spinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'
            });
        }
    </script>
    <script>
        $(function () {
            $.get("http://0.0.0.0:5050/childModeStatus", function (data) {
                if (data == 'off') {
                    $('#switch1').prop('checked', false);
                } else if (data == 'on') {
                    $('#switch1').prop('checked', true);
                }
            });
            $.get("http://0.0.0.0:5050/adminPasswordStatus", function (data) {
                if (data == 'set') {
                    $('#oldPasswordInput_container').show();
                    document.changePage('login');
                    setTimeout(function () {
                        document.loading_screen.finish();
                    }, 500);
                } else if (data == 'not set') {
                    $('#oldPasswordInput_container').hide();
                    document.changePage('settings');
                    setTimeout(function () {
                        document.loading_screen.finish();
                    }, 500);
                }
            });
            $('#loginBtn').on('click', function () {
                sessionStorage.adminPassword = $('#adminPasswordInput').val();
                $.post('http://0.0.0.0:5050/adminPasswordVerification', {
                    adminPassword: sessionStorage.adminPassword
                }).done(function (data) {
                    if (data == 'You have been logged in successfuly ;)') {
                        document.changePage('settings');
                    } else if (data == 'Authentication failed :(') {
                        alert(data);
                    }
                });
            });
            $('#passwordSubmitForm').on('submit', function () {
                $.post($(this).attr('action'), $(this).serialize()).done(function (data) {
                    alert(data)
                });
                return false;
            });
            $('#switch1').on('change', function () {
                if ($('#switch1').prop('checked') == false) {
                    $.post('http://0.0.0.0:5050/childModeDeactivate', {
                        adminPassword: sessionStorage.adminPassword
                    }).done(function (data) {
                        if (data == 'Authentication failed :(') {
                            $('#switch1').prop('checked', true);
                        }
                    });
                } else if ($('#switch1').prop('checked') == true) {
                    $.post('http://0.0.0.0:5050/childModeActivate', {
                        adminPassword: sessionStorage.adminPassword
                    }).done(function (data) {
                        if (data == 'Authentication failed :(') {
                            $('#switch1').prop('checked', false);
                        }
                    });
                }
            });
        });
    </script>
</head>

<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <!-- Title -->
                <span id="pageTitle" class="mdl-layout-title">Jste Manager</span>
            </div>
        </header>

        <main class="mdl-layout__content">
            <div class="page-content">
                <page id="login" style="display: none;">
                    <div id="loginFormContainer" style="position: fixed;left: 35%;top: 43%;">
                        <div class="mdl-textfield mdl-js-textfield">
                            <input class="mdl-textfield__input" name="newPassword" type="password" id="adminPasswordInput">
                            <label class="mdl-textfield__label" for="adminPasswordInput">Enter Your Password To Login</label>
                        </div>
                        <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" id="loginBtn">
                                Login
                              </button>
                    </div>
                </page>
                <page id="settings" style="display: none;">
                    <label for="switch1" class="mdl-switch mdl-js-switch mdl-js-ripple-effect">
                <input type="checkbox" id="switch1" class="mdl-switch__input">
                <span class="mdl-switch__label">Child Mode</span>
              </label>

                    <form id="passwordSubmitForm" action="http://0.0.0.0:5050/setAdminPassword" method="post">
                        <div class="mdl-textfield mdl-js-textfield" id="oldPasswordInput_container" style="display: none;">
                            <input class="mdl-textfield__input" type="password" name="oldPassword" id="oldPasswordInput">
                            <label class="mdl-textfield__label" for="oldPasswordInput">Old Password</label>
                        </div>
                        <div class="mdl-textfield mdl-js-textfield">
                            <input class="mdl-textfield__input" name="newPassword" type="password" id="newPasswordInput">
                            <label class="mdl-textfield__label" for="newPasswordInput">New Password</label>
                        </div>
                        <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" type="submit">
                            Set password
                          </button>
                    </form>
                </page>
            </div>
        </main>
    </div>
</body>

</html>